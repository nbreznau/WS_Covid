---
title: 'Institutionalized Inequality and Risk Perceptions: Government Intervention
  and Social Welfare during the Novel Coronavirus Pandemic'
output:
  html_document:
    df_print: paged
---

This is a follow up study of 

Breznau, Nate. 2020. “The Welfare State and Risk Perceptions: The Novel Coronavirus Pandemic and Public Concern in 70 Countries.” *European Societies*.

The following files are necessary to run this code
coronavirus_Aug01.xlsx: https://acleddata.com/analysis/covid-19-disorder-tracker/#1585775466317-4776d559-78fe 
covid-stringency-index.csv: https://ourworldindata.org/grapher/covid-stringency-index
WID_Data_14082020-111941.xlsx         https://wid.world/data/
ZA6900_v2-0-0.dta                     ISSP RoG 2016

Solt, Frederick. 2020. "Measuring Income Inequality Across Countries and Over Time: The Standardized World Income Inequality Database." Social Science Quarterly doi: 10.1111/ssqu.12795



```{r setup}
wdir <- function(x){
  paste(getwd(),x, sep = "/")
}


# need pacman package installed to run this
# install.packages("pacman")
pacman::p_load("dplyr","countrycode","car","ggplot2","jtools","sjPlot","sjmisc","sjlabelled","tidyverse","psych","lavaan","kableExtra","ggrepel","stringi","margins","readxl", "countrycode","haven")

```


```{r load_prep, message = F, warning = F}

# COVID-19 Survey

betrack <- read_dta(wdir("data/GlobalBehaviorsPerceptions_Data_May21_2020.dta")) 

# government response
gov_resp <- read.csv(file = wdir("data/OxCGRT_latest.csv"), header = T)


# ISSP RoG
issp16 <- read_dta(wdir("data/ZA6900_v2-0-0.dta"))

# Solt Gini
swiid <- load(wdir("data/swiid9_0.rda"))

# Death per million

covid <- read.csv(file = wdir("data/owid-covid-data.csv"), header = T)

## GDP per capita (2019)
gdp <- read.csv(file = wdir("data/GDP per capita WB.csv"), header = T,skip = 4)

## Social Spending 

socp <- read_xlsx(wdir("data/54614.xlsx"), skip = 5, sheet = 1)

```


```{r clean_issp, include = F}

# recode all questions so that higher values indicate support for government intervention

issp16 <- issp16 %>%
  mutate(
    cut_spend = car::recode(as.numeric(v7), '8=NA;9=NA'),
    spend_jobs = car::recode(as.numeric(v8), '1=5;2=4;3=3;4=2;5=1;else=NA'),
    reg_biz = car::recode(as.numeric(v9), '8=NA;9=NA'),
    sup_ind = car::recode(as.numeric(v10), '1=5;2=4;3=3;4=2;5=1;else=NA'),
    sup_ind2 = car::recode(as.numeric(v11), '1=5;2=4;3=3;4=2;5=1;else=NA'),
    gov_jobs = car::recode(as.numeric(v21), '1=5;2=4;8=3;3=2;4=1;else=NA'),
    gov_prices = car::recode(as.numeric(v22), '1=5;2=4;8=3;3=2;4=1;else=NA'),
    gov_health = car::recode(as.numeric(v23), '1=5;2=4;8=3;3=2;4=1;else=NA'),
    gov_old = car::recode(as.numeric(v24), '1=5;2=4;8=3;3=2;4=1;else=NA'),
    gov_ind3 = car::recode(as.numeric(v25), '1=5;2=4;8=3;3=2;4=1;else=NA'),
    gov_unemp = car::recode(as.numeric(v26), '1=5;2=4;8=3;3=2;4=1;else=NA'),
    gov_incd = car::recode(as.numeric(v27), '1=5;2=4;8=3;3=2;4=1;else=NA'),
    gov_house = car::recode(as.numeric(v29), '1=5;2=4;8=3;3=2;4=1;else=NA'),
    gov_laws = car::recode(as.numeric(v30), '1=5;2=4;8=3;3=2;4=1;else=NA'),
    gov_surveil = car::recode(as.numeric(v38), '1=5;2=4;8=3;3=2;4=1;else=NA'),
    gov_surveil2 = car::recode(as.numeric(v39), '1=5;2=4;8=3;3=2;4=1;else=NA'),
    gov_open = car::recode(as.numeric(v40), '10=5;9=4.5;8=4;7=3.5;6=3.5;5=3;4=2.5;3=2.5;2=2;1=1.5;0=1;else=NA'),
    gov_secure = car::recode(as.numeric(v41), '1=5;2=4;8=3;3=2;4=1;else=NA'),
    gov_detain = car::recode(as.numeric(v43), '1=5;2=4;8=3;3=2;4=1;else=NA'),
    gov_surveil3 = car::recode(as.numeric(v44), '1=5;2=4;8=3;3=2;4=1;else=NA'),
    gov_surveil4 = car::recode(as.numeric(v45), '1=5;2=4;8=3;3=2;4=1;else=NA'),
    gov_nosay = car::recode(as.numeric(v47), '1=5;2=4;3=3;4=2;5=1;else=NA'),
    cntry = as.numeric(country),
    cow = countrycode(cntry, origin = "iso3n", destination = "cown"),
    wave = 2016
  )%>%
  arrange(cow)


issp16df <- select(issp16, cow, wave, cut_spend:gov_nosay)

issp16_meain <- issp16df[complete.cases(issp16df),]


# check measurement invariance - ISSP 2016
# Take questions about government's inteverntion in unlikely events (public security, national security, terrorist act). These questions only exist in issp16

meaInmod1a <- " 
  preference =~ gov_surveil + gov_surveil2 + gov_secure" 
 
meaInmod1b <- " 
  intervene_security =~ 1*gov_surveil + 1.174*gov_surveil2 + 0.933*gov_secure 
  gov_surveil2 ~~ c(a,a,a,b,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a)*gov_secure
"

cfa <- cfa(model = meaInmod1a, data = issp16_meain)
summary(cfa,standardized = TRUE, fit.measures = TRUE)

configural1a <- cfa(model = meaInmod1a, data = issp16_meain, group = "cow")
fitmeasures(configural1a)

metric1a <- cfa(model = meaInmod1a, data = issp16_meain, group = "cow", group.equal = "loadings")
fitmeasures(metric1a)

metric1b <- cfa(model = meaInmod1b, data = issp16_meain, group = "cow")
fitmeasures(metric1b)



# create an authoritarian scale (just the surveillance items), maybe this is more the type of 'intervention' we want to measure. 


issp16_meain$gov_author <- round((issp16_meain$gov_surveil +
                                    1.174*issp16_meain$gov_surveil2 +
                                    0.933*issp16_meain$gov_secure)/3,2)





issp16dfa <- round(aggregate(issp16_meain, by = list(issp16_meain$cow), FUN = mean, na.rm = T),2)

issp16dfa <- dplyr::select(issp16dfa, cow, gov_author)


```


## Data cleaning - COVID deaths

```{r clean covid}
covid <- covid %>%
  mutate(
    dpm = total_deaths_per_million, # deaths per million
    cow = countrycode(location, origin = "country.name", destination = "cown"),
  ) %>%
  select(cow, date, dpm) %>%
  filter(cow %in% issp16df$cow)

##  Stage 1: First half of March

dpm_stage1 <- filter(covid, covid$date >= "2020-03-01" & covid$date <= "2020-03-15")

dpm_stage1 <- round(aggregate(dpm_stage1[,-2], by = list(dpm_stage1$cow), FUN = mean, na.rm = TRUE),4)

dpm_stage1$dpm1 <- ifelse(is.nan(dpm_stage1$dpm), 0, dpm_stage1$dpm)

dpm_stage1 <- select(dpm_stage1, cow, dpm1)

## Stage 2: From March 16th to April 7th

dpm_stage2 <- filter(covid, covid$date >= "2020-03-16" & covid$date < "2020-04-07")

dpm_stage2 <- round(aggregate(dpm_stage2[,-2], by = list(dpm_stage2$cow), FUN = mean, na.rm = TRUE),4)

dpm_stage2$dpm2 <- ifelse(is.nan(dpm_stage2$dpm), 0, dpm_stage2$dpm)

dpm_stage2 <- select(dpm_stage2, cow, dpm2)

```



## Data cleaing - Behaviors 

```{r clean_betrack, include = F}
betrack <- betrack %>%
  mutate(
    cow = countrycode(iso2c, origin = "iso2c", destination = "cown"),
    stay = beh_stayhome/20,
    gather = beh_socgathering/20,
    distance = beh_distance/20,
    tsymp = beh_tellsymp/20,
    hwash = beh_handwash/20
  ) %>%
  select(cow, date, stay, gather, distance, tsymp, hwash) 


```


## Measurement Invariance - Behaviors

```{r meaInbetrack}
## Measurement invariance - betrack

betrack_complete <- betrack[complete.cases(betrack),]
betrack_complete <- betrack_complete[which(betrack_complete$cow %in% issp16df$cow),]
betrack_complete <- betrack_complete[-which(betrack_complete$cow == 115),]

meaInmod2 <- "
  behave =~ stay + gather + distance
"
cfa2 <- cfa(model = meaInmod2, data = betrack_complete)
configural2 <- cfa(model = meaInmod2, data = betrack_complete, group = "cow")

metric2a <- cfa(model = meaInmod2, data = betrack_complete, group = "cow", group.equal = "loadings")
fitmeasures(metric2a)

meaInmod2b <- "
    behave =~ 1*stay + 0.776*gather + 1.083*distance
    stay ~~ c(a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,b,a,a,a,a,a,a,a,a)*gather
"

metric2b <- cfa(model = meaInmod2b, data = betrack_complete, group = "cow")

betrack$behave <- round((betrack$stay + 0.776*betrack$gather + 1.083*betrack$distance)/3,2)
betrack_av <- round(aggregate(betrack[,-2], by = list(betrack$cow), FUN = mean, na.rm = T),2)

```

## Data cleaning - Blavatnik

```{r clean_blavatnik, warning = F, message = F}
## First stage: March 1st to March 15th
gov_resp1 <- gov_resp %>%
  mutate(
    date = as.Date(as.character(Date), "%Y%m%d"),
    chi = ContainmentHealthIndex/20,
    cow = countrycode(CountryName, origin = "country.name", destination = "cown")
  ) %>%
  filter(date > "2020-03-01" & date < "2020-03-15" & cow %in% issp16dfa$cow) %>%
  select(CountryName, date, chi)

gov_resp1 <- aggregate(x = gov_resp1[,-2], by = list(gov_resp1$CountryName), FUN = mean)

gov_resp1 <- gov_resp1 %>%
  mutate(
    cname = Group.1,
    cow = countrycode(cname, origin = "country.name", destination = "cown"), 
    chi1 = round(chi,2)
  ) %>% 
  select(cow, chi1) %>%
  arrange(cow)

## Second stage: March 15th to March 31st

gov_resp2 <- gov_resp %>%
  mutate(
    date = as.Date(as.character(Date), "%Y%m%d"),
    chi = ContainmentHealthIndex/20,
    cow = countrycode(CountryName, origin = "country.name", destination = "cown")
  ) %>%
  filter(date > "2020-03-16" & date < "2020-03-31" & cow %in% issp16dfa$cow) %>%
  select(CountryName, date, chi)

gov_resp2 <- aggregate(x = gov_resp2[,-2], by = list(gov_resp2$CountryName), FUN = mean)

gov_resp2 <- gov_resp2 %>%
  mutate(
    cname = Group.1,
    cow = countrycode(cname, origin = "country.name", destination = "cown"), 
    chi2 = round(chi,2)
  ) %>% 
  select(cow, chi2) %>%
  arrange(cow)

## For sensitivity analysis: March 15th to April 7th

gov_resp3 <- gov_resp %>%
  mutate(
    date = as.Date(as.character(Date), "%Y%m%d"),
    chi = ContainmentHealthIndex/20,
    cow = countrycode(CountryName, origin = "country.name", destination = "cown")
  ) %>%
  filter(date > "2020-03-16" & date < "2020-04-07" & cow %in% issp16dfa$cow) %>%
  select(CountryName, date, chi)

gov_resp3 <- aggregate(x = gov_resp3[,-2], by = list(gov_resp3$CountryName), FUN = mean)

gov_resp3 <- gov_resp3 %>%
  mutate(
    cname = Group.1,
    cow = countrycode(cname, origin = "country.name", destination = "cown"), 
    chi3 = round(chi,2)
  ) %>% 
  select(cow, chi3) %>%
  arrange(cow)


```

## Income Inequality 

```{r clean_solt, warning = F, message = F}
rm (swiid)
swiid_summary$cow <- countrycode(swiid_summary$country, "country.name", "cown")

#some countries do not have data since 2016, take most recent available year
swiid_summary <- swiid_summary %>%
  mutate(year = ifelse(country == "Algeria" & year == 2011 | country == "Brunei" & year == 1981 | country == "Bosnia and Herzegovina" & year == 2015 | country == "Grenada" & year == 2008 | country == "Guatemala" & year == 2014 | country == "Iceland" & year == 2015 | country == "India" & year == 2012 | country == "Japan" & year == 2015 | country == "Morocco" & year == 2014 | country == "Pakistan" & year == 2015 | country == "Philippines" & year == 2015 | country == "South Africa" & year == 2015 | country == "United Arab Emirates" & year == 2008 | country == "Venezuela" & year == 2015, 2016, year))

# trim S. Africa
swiid_summary$gini_disp <- ifelse(swiid_summary$country == "South Africa" & swiid_summary$year == 2016, 55, swiid_summary$gini_disp)


swiid_summary <- subset(swiid_summary, year >= 2016)
swiid_summary <- select(swiid_summary, cow, gini_disp)
swiid_summary <- aggregate(swiid_summary, by = list(swiid_summary$cow), FUN = mean, na.rm = T)
gini_disp <- select(swiid_summary, cow, gini_disp)
rm(swiid_summary)


```

## GDP per capita

```{r gdp, warning = F, message = F}

gdp <- gdp %>%
  mutate(
    cow = countrycode(Country.Name, origin = "country.name", destination = "cown"),
    gdp = X2019
  ) %>%
  filter(cow %in% issp16dfa$cow) %>% 
  select(cow, gdp)

## Impute data for Venezuela (IMF report, estimated)

gdp[which(gdp$cow == 101),2] <- 2299.308

## Impute Taiwan (also from IMF report)
gdp[33,1] <- 713 
gdp[33,2] <- 25873.37

```

## Social Spending

```{r cwed2, warning = F, message = F}
socp <- socp %>%
  mutate(
    country = ...2,
    soc_spend = round(...19,2)
  ) %>%
  select(country, soc_spend)

socp <- socp[complete.cases(socp$soc_spend),]
socp$cow <- countrycode(socp$country, "country.name","cown")
socp <- socp %>%
  filter(cow %in% issp16dfa$cow) %>%
  select(cow, soc_spend)

```




## Merge data sets

```{r merge_clean}
betrack_av <- betrack_av %>% 
    filter(cow %in% issp16dfa$cow) %>%
    select(cow, behave)


df <- left_join(issp16dfa, gov_resp1, by = "cow")
df <- left_join(df, gov_resp2, by = "cow")
df <- left_join(df, gov_resp3, by = "cow")
df <- left_join(df, betrack_av, by = "cow")
df <- left_join(df, gini_disp, by = "cow")
df <- left_join(df, dpm_stage1, by = "cow")
df <- left_join(df, dpm_stage2, by = "cow")
df <- left_join(df, gdp, by = "cow")
df <- left_join(df, socp, by = "cow")

## filter out suriname 
df <- df[-which(df$cow==115),]


## Create a discrepancy index

df$discrep <- df$chi2 - df$gov_author

df$discrep2 <- df$chi3 - df$gov_author

df$discrep3 <- df$chi1 - df$gov_author

```



## Now start with some descriptive statistics 

```{r desc}
## Descriptive tables

tab1 <- descr(df[,c(2:4,6,7:11,13)],show = c("n","mean", "sd","range", "NA.prc"))
tab1[,1] <- c("Gov_Author", "Containtment Index - First stage", "Containment Index - Second Stage", "Behavior Index", "Gini", "Deaths per million - First stage", "Death per Million - Second Stage", "GDP", "Social Spending", "Discrepancy Index - Second Stage")
colnames(tab1) <- c("Variable", "N", "Missing cases", "Mean", "SD", "Range")
tab1[,c(4:5)] <- round(tab1[,c(4:5)],2)

tab2 <- descr(issp16_meain[,c("gov_surveil","gov_surveil2","gov_secure")],show = c("n","mean", "sd", "NA.prc"))
tab2[,1] <- c("Gov_Surveil", "Gov_Surveil2", "Gov_Secure")
colnames(tab2) <- c("Variable", "N", "Missing cases", "Mean", "SD")

tab2[,c(4:5)] <- round(tab2[,c(4:5)],2)

tab3 <- descr(betrack_complete[,c("stay","gather","distance")],show = c("n","mean", "sd", "NA.prc"))
tab3[,1] <- c("Stay Home", "Social Gather", "Keep Distance")
colnames(tab3) <- c("Variable", "N", "Missing cases", "Mean", "SD")

tab3[,c(4:5)] <- round(tab3[,c(4:5)],2)

# install.packages("htmlTable")
library(htmlTable)
htmlTable(tab1,rnames = FALSE)

## Figure A2

# install.packages("semPlot")
library(semPlot)
agg_png(wdir("figures/figa2.png"), width = 1600, height = 900)
semPaths(cfa, what = "std", layout = "tree", nodeLabels = c("gov_surv", "gov_surv2","gov_sec", "preference"),sizeLat = 14,sizeMan = 10, edge.color = "black",edge.label.cex = 0.9, nDigits = 3, rotation = 2)
invisible(dev.off())

## Figure A3
agg_png(wdir("figures/figa3.png"), width = 1600, height = 900)
semPaths(cfa2, what = "std", layout = "tree", nodeLabels = c("stay", "gather","distance", "behavior"),sizeLat = 14,sizeMan = 10, edge.color = "black",edge.label.cex = 0.9, nDigits = 3, rotation = 2)
invisible(dev.off())


## Figure 3 
# install.packages("ragg")
library(ragg)


discrep <- c(df$discrep3, df$discrep)
time <- c(rep("first", 32), rep("second", 32))
cntry <- rep(df$cow, 2)
df2 <- as.data.frame(cbind(discrep, time, cntry))
df2$time <- as.factor(df2$time)
df2$discrep <- as.numeric(df2$discrep)

agg_png(wdir("figures/fig3.png"),width = 1600,height = 900)
ggplot(data = df2, aes(x = discrep, fill = time)) +
  geom_density(alpha = 0.5, trim = FALSE) + 
  xlab(label = "Discrepancy Index") +
  ylab(label = "Density") +
  scale_fill_discrete(name = "Period", labels = c("01/03-15/03","15/03 - 30/03")) +
  theme(axis.title = element_text(size = 24,face = "bold"),legend.title = element_text(size = 24, face = "bold"), legend.text = element_text(size = 16)) 
invisible(dev.off())



```






## Stage 1
```{r m1}

m11 <- lm(chi1 ~ dpm1 + gov_author , data = df)

m12 <- lm(chi1 ~ dpm1 + gov_author + gini_disp, data = df)

m13 <- lm(chi1 ~ dpm1 + gov_author + soc_spend, data = df)

m14 <- lm(chi1 ~ dpm1 + gov_author + gdp, data = df)

m15 <- lm(chi1 ~ dpm1 + gov_author + gini_disp + soc_spend + gdp, data = df)

tab_model(m11, m12, m13, m14, m15, p.style = "stars", p.threshold = c(0.10, 0.05, 0.01), show.ci = F,  dv.labels = c("M11", "M12","M13", "M14","M15"), pred.labels = c("Intercept", "Deaths per Million", "Government Intervention", "Disposable Income Inequality", "Social Spending", "GDP Per Capita"))
```


## Stage 2

```{r m2}

m21 <- lm(behave ~ dpm2 + discrep, data = df)

m22 <- lm(behave ~ dpm2 + discrep + gini_disp, data = df)

m23 <- lm(behave ~ dpm2 + discrep + soc_spend, data = df)

m24 <- lm(behave ~ dpm2 + discrep + gdp, data = df)

m25 <- lm(behave ~ dpm2 + discrep + gini_disp + soc_spend + gdp, data = df)

m26 <- lm(behave ~ dpm2*discrep + gini_disp + soc_spend + gdp, data = df)



tab_model(m21, m22, m23, m24, m25, m26, p.style = "stars", p.threshold = c(0.10, 0.05, 0.01), show.ci = F,  dv.labels = c("M21", "M22","M23", "M24","M25", "M26"), pred.labels = c("Intercept", "Deaths per Million", "Discrepancy Index", "Disposable Income Inequality", "Social Spending", "GDP Per Capita", "Deaths*Discrepancy"), show.std = TRUE)
```




```{r m3}
## Discrepancy index from March 1st to March 15th


m31 <- lm(behave ~ dpm2 + discrep3, data = df)

m32 <- lm(behave ~ dpm2 + discrep3 + gini_disp, data = df)

m33 <- lm(behave ~ dpm2 + discrep3 + soc_spend, data = df)

m34 <- lm(behave ~ dpm2 + discrep3 + gdp, data = df)

m35 <- lm(behave ~ dpm2 + discrep3 + gini_disp + soc_spend + gdp, data = df)

m36 <- lm(behave ~ dpm2*discrep3 + gini_disp + soc_spend + gdp, data = df)


tab_model(m31, m32, m33, m34, m35, m36, p.style = "stars", p.threshold = c(0.10, 0.05, 0.01), show.ci = F,  dv.labels = c("M31", "M32","M33", "M34","M35", "M36"), pred.labels = c("Intercept", "Deaths per Million", "Discrepancy Index", "Disposable Income Inequality", "Social Spending", "GDP Per Capita", "Deaths*Discrepancy"))
```
## Sensitivity analysis

```{r m4}
## Discrepancy index all the way up to April 7th

m41 <- lm(behave ~ dpm2 + discrep2, data = df)

m42 <- lm(behave ~ dpm2 + discrep2 + gini_disp, data = df)

m43 <- lm(behave ~ dpm2 + discrep2 + soc_spend, data = df)

m44 <- lm(behave ~ dpm2 + discrep2 + gdp, data = df)

m45 <- lm(behave ~ dpm2 + discrep2 + gini_disp + soc_spend + gdp, data = df)

m46 <- lm(behave ~ dpm2*discrep2 + gini_disp + soc_spend + gdp, data = df)


tab_model(m41, m42, m43, m44, m45, m46, p.style = "stars", p.threshold = c(0.10, 0.05, 0.01), show.ci = F,   dv.labels = c("M41", "M42","M43", "M44","M45", "M46"), pred.labels = c("Intercept","Deaths per Million", "Discrepancy Index", "Disposable Income Inequality", "Social Spending", "GDP Per Capita", "Deaths*Discrepancy"))
```

```{r m5}
betrack <- read_dta(wdir("data/GlobalBehaviorsPerceptions_Data_May21_2020.dta")) 

betrack <- betrack %>%
  mutate(
    cow = countrycode(iso2c, origin = "iso2c", destination = "cown"),
    stay = beh_stayhome/20,
    gather = beh_socgathering/20,
    distance = beh_distance/20,
    tsymp = beh_tellsymp/20,
    hwash = beh_handwash/20
  ) %>%
  filter(cow %in% df$cow) %>%
  mutate(
    age_cat = age_yr_bin,
    female = ifelse(gender %in% c(1,2), gender - 1, NA_real_),
    edu_cat = educ_bin,
    edu_yrs = educ,
    inc_cat = inc_bin,
    behave = round((stay + 0.776*gather + 1.083*distance)/3,2)
  )
betrack$cntry <- countrycode(betrack$cow, "cown","country.name")
## Figure A.3
agg_png(wdir("figures/figa3.png"),width = 1600,height = 900)
ggplot(data = betrack, aes(x = age, fill = as.factor(cntry))) +
  geom_density(alpha = 0.5, trim = FALSE) + 
  xlab(label = "Age") +
  ylab(label = "Density") +
  scale_fill_discrete(name = "Country") +
  theme(axis.title = element_text(size = 24,face = "bold"),legend.title = element_text(size = 24, face = "bold"), legend.text = element_text(size = 16)) 
invisible(dev.off())
## Figure A.4
betrack_a4 <- betrack[complete.cases(betrack$edu_cat),]
agg_png(wdir("figures/figa4.png"),width = 1600,height = 900)
ggplot(data = betrack_a4, aes(x = as.factor(edu_cat), fill = as.factor(cntry))) +
  geom_bar() + 
  xlab(label = "Education categories") +
  ylab(label = "Count") +
  coord_flip() +
  scale_fill_discrete(name = "Country") +
  theme(axis.title = element_text(size = 24,face = "bold"),legend.title = element_text(size = 24, face = "bold"), legend.text = element_text(size = 16)) 
invisible(dev.off())

## Figure A.5
betrack_a5 <- betrack[complete.cases(betrack$inc_cat),]
agg_png(wdir("figures/figa5.png"),width = 1600,height = 900)
ggplot(data = betrack_a5, aes(x = as.factor(inc_cat), fill = as.factor(cntry))) +
  geom_bar() + 
  xlab(label = "Income categories") +
  ylab(label = "Count") +
  coord_flip() +
  scale_fill_discrete(name = "Country") +
  theme(axis.title = element_text(size = 24,face = "bold"),legend.title = element_text(size = 24, face = "bold"), legend.text = element_text(size = 16)) 
invisible(dev.off())

## Figure A6
betrack_a6 <- betrack[complete.cases(betrack$female),]

agg_png(wdir("figures/figa6.png"),width = 1600,height = 900)
ggplot(data = betrack_a6, aes(x = as.factor(female), fill = as.factor(cntry))) +
  geom_bar() + 
  xlab(label = "Female") +
  ylab(label = "Count") +
  coord_flip() +
  scale_fill_discrete(name = "Country") +
  theme(axis.title = element_text(size = 24,face = "bold"),legend.title = element_text(size = 24, face = "bold"), legend.text = element_text(size = 16)) 
invisible(dev.off())

```


